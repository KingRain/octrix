apiVersion: v1
kind: Namespace
metadata:
  name: ott-platform
  labels:
    app.kubernetes.io/part-of: octrix-demo
---
# Video Streaming Service - Main content delivery (8 pods)
apiVersion: apps/v1
kind: Deployment
metadata:
  name: streaming-service
  namespace: ott-platform
  labels:
    app: streaming-service
    tier: frontend
spec:
  replicas: 1
  selector:
    matchLabels:
      app: streaming-service
  template:
    metadata:
      labels:
        app: streaming-service
        tier: frontend
    spec:
      containers:
        - name: streaming
          image: nginx:alpine
          ports:
            - containerPort: 80
          resources:
            requests:
              cpu: 50m
              memory: 64Mi
            limits:
              cpu: 200m
              memory: 128Mi
---
apiVersion: v1
kind: Service
metadata:
  name: streaming-service
  namespace: ott-platform
spec:
  ports:
    - port: 80
      targetPort: 80
  selector:
    app: streaming-service
---
# CDN Edge Cache (10 pods)
apiVersion: apps/v1
kind: Deployment
metadata:
  name: cdn-cache
  namespace: ott-platform
  labels:
    app: cdn-cache
    tier: cache
spec:
  replicas: 10
  selector:
    matchLabels:
      app: cdn-cache
  template:
    metadata:
      labels:
        app: cdn-cache
        tier: cache
    spec:
      containers:
        - name: cache
          image: nginx:alpine
          ports:
            - containerPort: 80
          resources:
            requests:
              cpu: 30m
              memory: 64Mi
            limits:
              cpu: 150m
              memory: 128Mi
---
apiVersion: v1
kind: Service
metadata:
  name: cdn-cache
  namespace: ott-platform
spec:
  ports:
    - port: 80
      targetPort: 80
  selector:
    app: cdn-cache
---
# Transcoding Service - Video processing (6 pods)
apiVersion: apps/v1
kind: Deployment
metadata:
  name: transcoder
  namespace: ott-platform
  labels:
    app: transcoder
    tier: processing
spec:
  replicas: 6
  selector:
    matchLabels:
      app: transcoder
  template:
    metadata:
      labels:
        app: transcoder
        tier: processing
    spec:
      containers:
        - name: transcoder
          image: nginx:alpine
          ports:
            - containerPort: 8080
          resources:
            requests:
              cpu: 100m
              memory: 128Mi
            limits:
              cpu: 500m
              memory: 256Mi
---
apiVersion: v1
kind: Service
metadata:
  name: transcoder
  namespace: ott-platform
spec:
  ports:
    - port: 8080
      targetPort: 8080
  selector:
    app: transcoder
---
# User Authentication Service (4 pods)
apiVersion: apps/v1
kind: Deployment
metadata:
  name: auth-api
  namespace: ott-platform
  labels:
    app: auth-api
    tier: backend
spec:
  replicas: 4
  selector:
    matchLabels:
      app: auth-api
  template:
    metadata:
      labels:
        app: auth-api
        tier: backend
    spec:
      containers:
        - name: auth
          image: nginx:alpine
          ports:
            - containerPort: 3000
          resources:
            requests:
              cpu: 50m
              memory: 64Mi
            limits:
              cpu: 200m
              memory: 128Mi
---
apiVersion: v1
kind: Service
metadata:
  name: auth-api
  namespace: ott-platform
spec:
  ports:
    - port: 3000
      targetPort: 3000
  selector:
    app: auth-api
---
# Recommendation Engine (5 pods)
apiVersion: apps/v1
kind: Deployment
metadata:
  name: recommendations
  namespace: ott-platform
  labels:
    app: recommendations
    tier: ml
spec:
  replicas: 5
  selector:
    matchLabels:
      app: recommendations
  template:
    metadata:
      labels:
        app: recommendations
        tier: ml
    spec:
      containers:
        - name: recommender
          image: nginx:alpine
          ports:
            - containerPort: 5000
          resources:
            requests:
              cpu: 100m
              memory: 128Mi
            limits:
              cpu: 400m
              memory: 256Mi
---
apiVersion: v1
kind: Service
metadata:
  name: recommendations
  namespace: ott-platform
spec:
  ports:
    - port: 5000
      targetPort: 5000
  selector:
    app: recommendations
---
# API Gateway (7 pods)
apiVersion: apps/v1
kind: Deployment
metadata:
  name: api-gateway
  namespace: ott-platform
  labels:
    app: api-gateway
    tier: gateway
spec:
  replicas: 7
  selector:
    matchLabels:
      app: api-gateway
  template:
    metadata:
      labels:
        app: api-gateway
        tier: gateway
    spec:
      containers:
        - name: gateway
          image: nginx:alpine
          ports:
            - containerPort: 8000
          resources:
            requests:
              cpu: 50m
              memory: 64Mi
            limits:
              cpu: 200m
              memory: 128Mi
---
apiVersion: v1
kind: Service
metadata:
  name: api-gateway
  namespace: ott-platform
spec:
  ports:
    - port: 8000
      targetPort: 8000
  selector:
    app: api-gateway
